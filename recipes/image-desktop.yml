name: sukarn-ublue-desktop
description: Customized for desktops with nvidia graphics card.
#base-image: ghcr.io/ublue-os/silverblue-nvidia # Cannot use coreos_kernel.sh
#base-image: ghcr.io/ublue-os/silverblue-main
base-image: ghcr.io/ublue-os/bluefin-nvidia
image-version: gts # When the version changes, the COPY line below for nvidia-open will need an accompanying version change.
# Possible options for `image-version`:
# Numbered fedora release (`40`, `41`); `latest`; `gts`.
# Some images also support `stable`. Check the available tags of the image being used.

## Bluefin-specific
modules:
  - type: dnf
    remove:
      packages:
        - adcli
        - bcache-tools
        - bluefin-backgrounds
        - bluefin-cli-logos
        - bluefin-faces
        - bluefin-fastfetch
        - bluefin-logos
        - bluefin-plymouth
        - bluefin-schemas
        - borgbackup
        - cryfs
        - ddcutil
        - epson-inkjet-printer-escpr
        - epson-inkjet-printer-escpr2
        - evtest
        - fastfetch
        - firewall-config
        - fish
        - foo2zjs
        - framework-laptop-kmod-common-0.0.git.326.1665246e-1.fc41.noarch
        - fuse-encfs
        - git-credential-libsecret
        - glow
        - gnome-shell-extension-dash-to-dock
        - gnome-shell-extension-logo-menu
        - gnome-shell-extension-search-light
        - gnome-shell-extension-tailscale-gnome-qs
        - gnome-tweaks
        - gum
        - ibus-mozc
        - ifuse
        - input-remapper
        - jetbrains-mono-fonts-all
        - kmod-framework-laptop
        - kmod-openrazer
        - kmod-zfs
        - krb5-workstation
        - libsss-autofs
        - libxcrypt-compat
        - libzfs6
        - libzpool6
        - mozc
        - nerd-fonts
        - oddjob-mkhomedir
        - opendyslexic-fonts
        - openrazer-kmod-common
        - openssh-askpass
        - powertop
        - printer-driver-brlaser
        - python3-pip
        - python3-pygit2
        - rclone
        - restic
        - samba-dcerpc
        - samba-ldb-ldap-modules
        - samba-winbind-clients
        - samba-winbind-modules
        - setools-console
        - sssd-ad
        - sssd-krb5
        - ublue-bling
        - ublue-brew
        - ublue-fastfetch
        - ublue-motd
        - ublue-polkit-rules
        - ublue-setup-services
        - uld
        - usbmuxd
        - yaru-theme
        - zenity
        - zfs
        - zsh

## General
  - from-file: variant-gnome.yml

#  - type: script
#    scripts:
#      - kernel_bazzite_gated.sh
#      - nvidia.sh

  - type: files
    files:
      - source: desktop
        destination: /

  - type: gschema-overrides
    include:
      - zz2-sukarn-desktop.gschema.override

  - type: kargs
    arch: x86_64
    kargs:
      - nvme_core.default_ps_max_latency_us=0
      - amd_iommu=off
      - rd.driver.blacklist=nouveau
      - modprobe.blacklist=nouveau
      - nvidia-drm.modeset=1
      - nvidia_drm.fbdev=1
#      - nvidia.NVreg_EnableGpuFirmware=0
      - initcall_blacklist=simpledrm_platform_driver_init

## Bluefin-specific
  - type: systemd
    system:
      disabled:
        - dconf-update.service
        - ublue-guest-user.service
        - brew-setup.service
        - brew-upgrade.timer
        - brew-update.timer
        - ublue-fix-hostname.service
        - ublue-system-setup.service
        - ublue-user-setup.service
        - podman-auto-update.timer
        - check-sb-key.service
        - input-remapper.service
        - uupd.timer
        - rpm-ostreed-automatic.timer
        - flatpak-system-update.timer
        - flatpak-user-update.timer
    user:
      disabled:
        - ublue-user-setup.service
        - podman-auto-update.timer
        - flatpak-user-update.timer

  - from-file: base-last-steps.yml
